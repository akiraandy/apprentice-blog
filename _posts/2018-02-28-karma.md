---
layout: post
title: "Karma"
description: "Konfiguring Karma"
categories: [code]
tags: [TDD, code, javascript, karma]
redirect_from:
  - /2018/02/28
---
This week I've been learning a lot about how to set up both Jasmine and Karma to work together for testing the frontend JavaScript for my Tic Tac Toe application. I'd like to go over how I configured Karma and go a little deeper into what Karma is and why we should use it.

First of all, what is Karma? In a nutshell, Karma is a test runner that executes source code against test code in a set of specified browsers. The results can be examined and displayed via the command line to see which browsers and tests passed of failed. Karma also "watches" all the files so that when any file changes it will trigger a rerun of all the tests. This enables better feedback between tests and source code. But wait, is Jasmine a runner? That's what I thought too, but Jasmine is a test framework, which means it supplies the syntax, matchers and assertions for tests. Jasmine can and does run tests, but it doesn't care about what browser you use and it won't update your tests to reflect any new changes you've made to either your source code or tests unless you've manually restarted the test runner. Karma wraps Jasmine in an automation layer and provides better feedback than Jasmine would alone (along with some sweet integration with Webpack ;) ).

So how do you get Karma up and running? Well first you need to install a couple of node modules via npm.

```
$ npm install --save-dev karma karma-jasmine karma-firefox-launcher karma-webpack jasmine-core
```
This will install karma, karma-jasmine, karma-firefox-launcher and karma-webpack node modules respectively. Then we install the Karma command-line interface globally:
```
npm install -g karma-cli
```
Now we need to generate a Karma configuration file:
```
karma init karma.conf.js
```
The setup will ask you several questions and you want to tell it that you're using Jasmine, and don't use RequireJS.

At the top of our config file we need to require our Webpack configuration so we can tell Karma to compile our files before every test.
```
var webpackConfig = require('./webpack.config.js');
```
Then we add a ```webpack``` section to the Karma config module:
```
webpack: webpackConfig,
```
Then we tell Karma to preprocess our test files with Webpack with the following code:
```
preprocessors: {
  'spec/javascripts/*_spec.js': ['webpack']
},
```
My Karma config file looks like this:
```
var webpackConfig = require('./webpack.config.js');
 module.exports = function(config) {
   config.set({
     basePath: '',
     frameworks: ['jasmine', 'jquery-3.2.1'],
     files: [
         'spec/javascripts/fixtures/myfixture.html',
         'spec/javascripts/jasmine_plugins/*.js',
         'spec/javascripts/*.js'
     ],
     preprocessors: {
        'spec/javascripts/*.js': 'webpack'
     },
     webpack: webpackConfig,
     reporters: ['progress'],
     port: 9876,
     colors: true,
     logLevel: config.LOG_INFO,
     autoWatch: true,
     browsers: ['Firefox'],
     singleRun: false,
     concurrency: Infinity
  })
}
```
For my use case I included jQuery as an additional framework for my test runner. I also am using Jasmine-Jquery and those are including in my ```spec/javascripts/jasmine_plugins/``` folder. Jasmine-jquery also allows you to use "fixtures" which is basically dummy HTML.  

With this setup I'm able to not only automate my tests but I'm able to automatically compile my source and test code before every test. There's a lot more customization you can do for Karma but I'll leave that for another blog post.
